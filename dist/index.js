!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){e.exports=require("underscore")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("http-errors")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("redis")},function(e,t){e.exports=require("connect-redis")},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"App",(function(){return nt})),n.d(t,"Repository",(function(){return rt})),n.d(t,"acl",(function(){return ot})),n.d(t,"aclManager",(function(){return it})),n.d(t,"cache",(function(){return at})),n.d(t,"crypter",(function(){return ut})),n.d(t,"database",(function(){return ct})),n.d(t,"Model",(function(){return st})),n.d(t,"Module",(function(){return lt})),n.d(t,"createError",(function(){return ft})),n.d(t,"express",(function(){return pt})),n.d(t,"Router",(function(){return ht}));var o,i,a=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.req=t,this.Model=n,this.data=r}var t,n,o;return t=e,(n=[{key:"prepareOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0===e.row&&(e.row=!0),e}},{key:"create",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return new Promise((function(t,r){var o;(o=e.Model).create.apply(o,n).then((function(e){return t(e)})).catch((function(e){return r(e)}))}))}},{key:"createBulk",value:function(){}},{key:"paginate",value:function(e){return this.findAll()}},{key:"findAll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(n,r){e.Model.findAll(e.prepareOptions(t)).then((function(e){return n(e)})).catch((function(e){return r(e)}))}))}},{key:"findById",value:function(e){var t=this;return new Promise((function(n,r){t.Model.findOne(t.prepareOptions({where:e})).then((function(e){return n(e)})).catch((function(e){return r(e)}))}))}},{key:"findOne",value:function(){var e=this;return new Promise((function(t,n){e.Model.findOne(e.prepareOptions(args)).then((function(e){return t(e)})).catch((function(e){return n(e)}))}))}},{key:"updateById",value:function(e,t){}},{key:"deleteById",value:function(e){}},{key:"deleteAll",value:function(e){}}])&&r(t.prototype,n),o&&r(t,o),e}(),u=n(1),c=n.n(u),s=n(5),l=n.n(s),f=n(6),p=n.n(f),h=n(0),y=n.n(h),d=n(7),b=n.n(d),v=n(8),m=n(9),g=n.n(m),w=function(){if(i=function(e){var t=parseInt(e,10);if(isNaN(t))return e;if(t>=0)return t;return!1}(process.env.PORT||this.config.port),this.app.set("port",i),o=v.createServer(this.app),!0===this.config.useSocket){var e=g()(o);this.initSocket(e)}o.listen(i),o.on("error",j),o.on("listening",O)};function O(){var e=o.address(),t="string"==typeof e?"pipe "+e:"port "+e.port;console.log("Listening on "+t)}function j(e){if("listen"!==e.syscall)throw e;var t="string"==typeof i?"Pipe "+i:"Port "+i;switch(e.code){case"EACCES":console.error(t+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(t+" is already in use"),process.exit(1);break;default:throw e}}var k={setPort:function(e){return this.config.port=e,this},use:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.uses.push(t),this},get:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.routers.push(["get"].concat(t)),this},post:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.routers.push(["post"].concat(t)),this},put:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.routers.push(["put"].concat(t)),this},delete:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.routers.push(["delete"].concat(t)),this},addRouter:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.routers.push(["router"].concat(t)),this},addPublic:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.publicFolders.push(t),this}},S=n(4),P=n.n(S),A=n(10),E=n.n(A),x=n(11),R=n.n(x);function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=n(12),T=new WeakMap,I=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),T.set(this,{writable:!0,value:null})}var t,n,r;return t=e,(n=[{key:"setSecret",value:function(e){!function(e,t,n){var r=t.get(e);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}}(this,T,e)}},{key:"encrypt",value:function(e){return C.createHmac("sha256",function(e,t){var n=t.get(e);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(e):n.value}(this,T)).update(e).digest("hex")}}])&&M(t.prototype,n),r&&M(t,r),e}());function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U={useSession:function(e){return"string"==typeof e?(this.config.useSession=!0,this.config.session.config.secret=e,I.setSecret(e)):this.config.useSession=e,this},setSessionConfig:function(e,t,n){void 0===t?this.config.session.config=e:this.config.session=void 0!==n?{type:e,config:t,redisConfig:n}:{type:e};var r=this.config.session.config.secret;return void 0!==r&&I.setSecret(r),this},init:function(){if(!0===this.config.useSession){var e=this.config.session.config;if("redis"===this.config.session)e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({store:new(R()(P.a))({client:E.a.createClient(this.config.session.redisConfig)})},this.config.session.config);this.app.use(P()(e))}}},q=n(2),N=n.n(q);function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),F(this,"name",void 0),F(this,"url",null),F(this,"fields",{}),F(this,"translatedFields",[]),F(this,"createForm",null),F(this,"editForm",null),F(this,"softDeletable",!1),F(this,"virtualFields",{}),F(this,"links",{}),F(this,"hooks",{})}var t,n,r;return t=e,(n=[{key:"getFields",value:function(){var e=this,t={};return y.a.each(Object.keys(this.fields),(function(n){t[n]={type:e.fieldMapping(n),uniq:n.uniq}})),t}},{key:"build",value:function(e){return e.define(this.name,this.getFields(),{tableName:this.name})}},{key:"fieldMapping",value:function(e){switch(e.type){case"text":return N.a.STRING(void 0!==e.length?e.length:250);case"boolean":return N.a.BOOLEAN;default:return N.a.STRING(void 0!==e.length?e.length:250)}}}])&&L(t.prototype,n),r&&L(t,r),e}();function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=J(e);if(t){var o=J(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return G(this,n)}}function G(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?Y(e):t}function Y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(n,e);var t=$(n);function n(){var e;W(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return K(Y(e=t.call.apply(t,[this].concat(o))),"name","user"),K(Y(e),"url","users"),K(Y(e),"fields",{username:{type:"text",uniq:!0,length:250},password:{type:"text",length:500},token:{type:"text",length:500},acl:{type:"text",length:500},tokenExpiresAt:{type:"datetime",length:500},refreshToken:{type:"text",length:500},registrationToken:{type:"text",length:500},registrationTokenExpiresAt:{type:"datetime",length:500},registered:{type:"boolean"},active:{type:"boolean"}}),e}return n}(H);function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Z=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"main",o=e.databases[r];if(void 0===o)throw new Error("Database '".concat(r,"' is not registered"));var i=o.models[n];if(void 0===i)throw new Error("Model '".concat(n,"' is not registered in database '").concat(r,"'"));var u=e.models[n],c=e.repositories[n],s=void 0!==c?c:a;return new s(t,i,u)};Z.hasUrlModel=function(e){return void 0!==Z.modelsUrl[e]},Z.getUrlRepository=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"main";return Z(e,Z.modelsUrl[t],n)},Z.databases={main:{database:null,models:{}}},Z.modelsUrl={},Z.models={user:Q},Z.repositories={},Z.addRepository=function(e,t){Z.repositories[e]=t},Z.getModel=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main";return Z.databases[t].models[e]},Z.init=function(e){y.a.each(e.models,(function(e){var t=(new e).name;Z.models[t]=e})),Z.databases.main.database=new N.a(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){X(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({dialect:"postgres"},e.config.database)),Z.processModels("main"),Z.databases.main.database.sync()},Z.processModels=function(e){var t=Z.databases[e].database;y.a.each(Object.keys(Z.models),(function(n){var r=new Z.models[n];Z.modelsUrl[null!==r.url?r.url:n]=n,Z.databases[e].models[n]=r.build(t)}))};var ee=Z;function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e){return function(e){if(Array.isArray(e))return re(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return re(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var oe={setDatabaseConfig:function(e){return this.config.database=e,this},addModel:function(e){return this.models.push(e),this},addModels:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.models=[].concat(ne(this.models),t),this},init:function(){"object"===te(this.config.database)&&ee.init(this)}},ie=function(e){return new Error("Parameter '".concat(e,"' is required"))};function ae(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function ue(e){return function(e){if(Array.isArray(e))return ce(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ce(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fe=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),le(this,"pool",{ROLE_SUPER_ADMIN:{ROLE_ADMIN:{ROLE_USER:{ROLE_ANONYMOUS:{}}}}}),le(this,"flatPool",{}),this.prepareHierarchy()}var t,n,r,o,i;return t=e,(n=[{key:"setHierarchy",value:function(e){this.pool=e,this.prepareHierarchy()}},{key:"getPool",value:function(){return this.pool}},{key:"addRole",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie("roleName"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===t)this.pool[e.toUpperCase()]={};else{if(void 0===this.pool[t.toUpperCase()])throw new Error("Role ".concat(t," was not found in hierarchy"));this.pool.ROLE_SUPER_ADMIN[e.toUpperCase()]={},console.log("add "+e.toUpperCase())}this.prepareHierarchy()}},{key:"prepareHierarchy",value:function(){var e=this;this.flatPool={},y.a.each(Object.keys(this.pool),(function(t){e.flatPool[t]=function t(n,r){var o=Object.keys(r),i=[n];return y.a.each(o,(function(n){var o=t(n,r[n]);e.flatPool[n]=o,i=[].concat(ue(i),ue(o))})),i}(t,e.pool[t])}))}},{key:"isGranted",value:(o=regeneratorRuntime.mark((function e(t,n){var r,o,i,a,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("ROLE_ANONYMOUS"!==n){e.next=2;break}return e.abrupt("return",!0);case 2:if(r=function(e){return-1===[null,void 0].indexOf(e)},o=function(){return!0===r(t)&&!0===r(t.session)&&!0===r(t.session.user)&&void 0!==u.flatPool[t.session.user.acl]&&-1!==u.flatPool[t.session.user.acl].indexOf(n)},i=t.get("token"),!1!==r(i)){e.next=7;break}return e.abrupt("return",o());case 7:return e.prev=7,e.next=10,new Promise((function(e,t){return ee("user").findOne({where:{token:i}}).then((function(n){if(null===n)return t();e(n)})).catch((function(e){return t(!1)})),res.session.user=a,o()}));case 10:a=e.sent,e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(7),t.session.user=void 0,e.abrupt("return",o());case 17:case"end":return e.stop()}}),e,null,[[7,13]])})),i=function(){var e=this,t=arguments;return new Promise((function(n,r){var i=o.apply(e,t);function a(e){ae(i,n,r,a,u,"next",e)}function u(e){ae(i,n,r,a,u,"throw",e)}a(void 0)}))},function(e,t){return i.apply(this,arguments)})}])&&se(t.prototype,n),r&&se(t,r),e}());function pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||ye(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e){return function(e){if(Array.isArray(e))return de(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||ye(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(e,t){if(e){if("string"==typeof e)return de(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?de(e,t):void 0}}function de(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var me=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ve(this,"rooms",{}),ve(this,"actions",{}),ve(this,"roomAcls",{}),ve(this,"sockets",[])}var t,n,r;return t=e,(n=[{key:"addSockets",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.sockets=[].concat(he(this.sockets),t)}},{key:"addActions",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];y.a.each(t,(function(e){var t=pe(e,2),n=t[0],r=t[1];void 0===actions[n]&&(actions[n]={},y.a.each(Object.keys(r),(function(e){actions[n].message=r[e]})))}))}},{key:"getRoomType",value:function(e){if("string"==typeof e)return e;if(-1===[null,void 0].indexOf(e)&&"array"===e.constructor.name.toLowerCase()){var t=pe(e,2),n=t[0],r=t[1];return this.roomAcls[n]=r.toUpperCase(),n}return null}},{key:"init",value:function(e){var t=this;y.a.each(this.sockets,(function(n){var r=t.getRoomType(n);null!==r&&(t.rooms[r]=e.of("/socket_".concat(r.toLowerCase())),t.rooms[r].on("connection",(function(e){void 0!==t.roomAcls[r]||y.a.each(t.actions[r],(function(t){var n=pe(t,2),r=n[0],o=n[1];e.on(r,o)}))})))}))}}])&&be(t.prototype,n),r&&be(t,r),e}()),ge={setSocketConfig:function(e){return this.config.socket=void 0===e?{}:e,this},useSocket:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.config.useSocket=e,this.config.useSessionSocket=t,this},addRooms:function(){return me.addSockets.apply(me,arguments),this},includeSockets:function(){return me.addActions.apply(me,arguments),this},initSocket:function(e){return me.init(e),this}};function we(e){return function(e){if(Array.isArray(e))return Oe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Oe(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Se=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ke(this,"name",null),ke(this,"initializers",{}),ke(this,"routers",[]),ke(this,"publicPaths",[]),ke(this,"models",[]),ke(this,"socketRooms",[]),ke(this,"sockets",[]),ke(this,"acls",[])};function Pe(e){return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xe(e,t){return(xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Te(e);if(t){var o=Te(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Me(this,n)}}function Me(e,t){return!t||"object"!==Pe(t)&&"function"!=typeof t?Ce(e):t}function Ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Te(e){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _e=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xe(e,t)}(i,e);var t,n,r,o=Re(i);function i(){var e;Ae(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ie(Ce(e=o.call.apply(o,[this].concat(n))),"modules",{}),e}return t=i,(n=[{key:"hasModule",value:function(e){return void 0!==this.modules[e]}},{key:"getModule",value:function(e){return this.modules[e]}},{key:"addModule",value:function(e,t){if(t.prototype instanceof Se==0)throw new Error("Parameter must be a Module instance");var n=new t;this.modules[n.name]=n,this.merge(e,n)}}])&&Ee(t.prototype,n),r&&Ee(t,r),i}(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"merge",value:function(e,t){this.mergeInitializers(e,t).mergeModels(e,t).mergeRouters(e,t).mergePublic(e,t).mergeSocketRooms(e,t).mergeSockets(e,t).mergeAcls(e,t)}},{key:"mergeInitializers",value:function(e,t){var n=["constructor"];return y.a.each(Object.keys(t.initializers),(function(r){var o=t.initializers[r];"init"===r?e.inits.push(o):-1===n.indexOf(r)&&(e[r]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return o.call.apply(o,[e].concat(n))})})),this}},{key:"mergeRouters",value:function(e,t){return y.a.each(t.routers,(function(t){"array"===t.constructor.name.toLowerCase()?e.addRouter.apply(e,we(t)):e.addRouter(t)})),this}},{key:"mergePublic",value:function(e,t){return y.a.each(t.publicPaths,(function(t){e.addPublic.apply(e,we(t))})),this}},{key:"mergeModels",value:function(e,t){return e.addModels.apply(e,we(t.models)),this}},{key:"mergeSocketRooms",value:function(e,t){return e.addRooms.apply(e,we(t.socketRooms)),this}},{key:"mergeSockets",value:function(e,t){return this}},{key:"mergeAcls",value:function(e,t){return y.a.each(t.acls,(function(t){e.addAcl(t)})),this}}])&&je(t.prototype,n),r&&je(t,r),e}()));function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ue=new(function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r={},(n="website")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"addWebsite",value:function(e){}}])&&De(t.prototype,n),r&&De(t,r),e}()),qe={addWebsite:function(e){return Ue.addWebsite(e),this},addWebsites:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return y.a.each(n,(function(t){return e.addWebsite(t)})),this},addModule:function(e){return _e.addModule(this,e),this},addModules:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return y.a.each(n,(function(t){return e.addModule(t)})),this},getModule:function(e){return _e.getModule(e)},init:function(){}},Ne={setAclHierarchy:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie("hierarchy");return fe.setHierarchy(e),this},addAclRole:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie("roleName"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return fe.addRole(e,t),this},init:function(){fe.prepareHierarchy()}};function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}new(function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=null,(n="loginMethod")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"setLoginMethod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==e&&"function"!=typeof e)throw new Error("Custom login method must be a function");this.loginMethod=e}},{key:"login",value:function(e,t){return new Promise((function(t,n){var r=e.username,o=e.password,i=function(e){return-1!==[null,void 0].indexOf(e)};if(!0===i(r)||!0===i(o))return n(new Error("Invalid login parameters"));var a=I(o);ee.getRepository(e,"user").findOne({where:{username:r,password:a,active:!0}}).then((function(e){if(null===e)return n(new Error("User was not found"));t(e)})).catch((function(e){return n(e)}))}))}}])&&Le(t.prototype,n),r&&Le(t,r),e}());function Fe(e){return function(e){if(Array.isArray(e))return e}(e)||We(e)||ze(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e){return function(e){if(Array.isArray(e))return Be(e)}(e)||We(e)||ze(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ze(e,t){if(e){if("string"==typeof e)return Be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Be(e,t):void 0}}function We(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(n),!0).forEach((function(t){Je(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ke=[k,U,oe,ge,qe,Ne];function Qe(){for(var e=this,t=["build"],n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];y.a.each(r,(function(n){y.a.each(Object.keys(n),(function(r){"init"===r?e.inits.push(n[r]):-1===t.indexOf(r)&&(e[r]=function(){for(var t,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return(t=n[r]).call.apply(t,[e].concat(i))})}))}))}var Ve=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Je(this,"app",c()()),Je(this,"uses",[]),Je(this,"routers",[]),Je(this,"publicFolders",[]),Je(this,"models",[]),Je(this,"io",null),Je(this,"config",{customError:null,port:3e3,session:{type:null,config:{},redisConfig:void 0},socket:{}}),Je(this,"defaultConfig",{useCors:!1,statics:{},useSession:!1,useCompression:!0,useSocket:!1,useSessionSocket:!1}),Je(this,"inits",[]),Qe.call.apply(Qe,[this].concat(Ke))}var t,n,r;return t=e,(n=[{key:"run",value:function(){var e=this;this.config=Ge(Ge({},this.defaultConfig),this.config),this.app.set("trust proxy",1),y.a.each(this.inits,(function(t){t.call(e)})),this.app.use(p()("dev")),this.app.use(c.a.json()),this.use(c.a.urlencoded({extended:!1})),this.use(l()()),this.use(b()()),y.a.each(this.publicFolders,(function(t){1===t.length?e.app.use(c.a.static.apply(c.a,He(t))):2===t.length&&e.app.use(t[0],c.a.static(t[1]))})),y.a.each(this.uses,(function(t){var n;(n=e.app).use.apply(n,He(t))})),y.a.each(this.routers,(function(t){var n,r=Fe(t),o=r[0],i=r.slice(1);(n=e.app)["router"===o?"use":o].apply(n,He(i))})),null===this.config.customError&&this.app.use((function(e,t,n,r){n.status(e.status||500).json({valid:!1,error:e.message})})),w.call(this)}}])&&Ye(t.prototype,n),r&&Ye(t,r),e}());function Xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ze=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"get",value:function(e){return new Promise((function(e,t){return null}))}},{key:"set",value:function(e,t,n){}}])&&Xe(t.prototype,n),r&&Xe(t,r),e}()),et=n(3),tt=n.n(et),nt=Ve,rt=a,ot=function(e){return function(t,n,r){return!0===fe.isGranted(t,e)?r():r(tt()(401,"You are not allowed to access this area"))}},it=fe,at=Ze,ut=I,ct=ee,st=H,lt=Se,ft=tt.a,pt=c.a,ht=pt.Router}]));