{"code":"!function(e,t){for(var r in t)e[r]=t[r]}(exports,function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=10)}([function(e,t){e.exports=require(\"underscore\")},function(e,t){e.exports=require(\"express\")},function(e,t){e.exports=require(\"sequelize\")},function(e,t){e.exports=require(\"cookie-parser\")},function(e,t){e.exports=require(\"morgan\")},function(e,t){e.exports=require(\"compression\")},function(e,t){e.exports=require(\"http\")},function(e,t){e.exports=require(\"http-errors\")},function(e,t){e.exports=require(\"path\")},function(e,t){e.exports=require(\"socket.io\")},function(e,t,r){\"use strict\";r.r(t),r.d(t,\"App\",(function(){return j})),r.d(t,\"database\",(function(){return T})),r.d(t,\"express\",(function(){return q})),r.d(t,\"acl\",(function(){return z}));var n=r(1),i=r.n(n),o=(r(8),r(3)),s=r.n(o),a=r(4),c=r.n(a),u=r(0),l=r.n(u),d=r(5),f=r.n(d),h=r(6);let p;var O,b=function(){if(O=function(e){var t=parseInt(e,10);if(isNaN(t))return e;if(t>=0)return t;return!1}(process.env.PORT||\"3000\"),this.app.set(\"port\",O),p=h.createServer(this.app),!0===this.config.useSocket){const e=r(9)(p);this.initSocket(e)}p.listen(O),p.on(\"error\",v),p.on(\"listening\",m)};function m(){var e=p.address(),t=\"string\"==typeof e?\"pipe \"+e:\"port \"+e.port;console.log(\"Listening on \"+t)}function v(e){if(\"listen\"!==e.syscall)throw e;var t=\"string\"==typeof O?\"Pipe \"+O:\"Port \"+O;switch(e.code){case\"EACCES\":console.error(t+\" requires elevated privileges\"),process.exit(1);break;case\"EADDRINUSE\":console.error(t+\" is already in use\"),process.exit(1);break;default:throw e}}!function(){var e=new Error(\"Cannot find module './core/initializers/main'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),function(){var e=new Error(\"Cannot find module './core/initializers/session'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),function(){var e=new Error(\"Cannot find module './core/initializers/database'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),function(){var e=new Error(\"Cannot find module './core/initializers/socket'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),function(){var e=new Error(\"Cannot find module './core/initializers/third'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),function(){var e=new Error(\"Cannot find module './core/initializers/acl'\");throw e.code=\"MODULE_NOT_FOUND\",e}();function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const N=[!function(){var e=new Error(\"Cannot find module './core/initializers/main'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),!function(){var e=new Error(\"Cannot find module './core/initializers/session'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),!function(){var e=new Error(\"Cannot find module './core/initializers/database'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),!function(){var e=new Error(\"Cannot find module './core/initializers/socket'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),!function(){var e=new Error(\"Cannot find module './core/initializers/third'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),!function(){var e=new Error(\"Cannot find module './core/initializers/acl'\");throw e.code=\"MODULE_NOT_FOUND\",e}(),!function(){var e=new Error(\"Cannot find module './core/initializers/acl'\");throw e.code=\"MODULE_NOT_FOUND\",e}()];function g(...e){const t=[\"build\"];l.a.each(e,e=>{l.a.each(Object.keys(e),r=>{\"init\"===r?this.inits.push(e[r]):-1===t.indexOf(r)&&(this[r]=(...t)=>e[r].call(this,...t))})})}var E=new class{constructor(){w(this,\"app\",i()()),w(this,\"uses\",[]),w(this,\"routers\",[]),w(this,\"publicFolders\",[]),w(this,\"models\",[]),w(this,\"sockets\",[]),w(this,\"io\",null),w(this,\"config\",{admin:{use:!1},session:{type:null,config:{},redisConfig:void 0},socket:{}}),w(this,\"defaultConfig\",{useCors:!1,statics:{},useSession:!0,useCompression:!0,useSocket:!1,useSessionSocket:!1}),w(this,\"inits\",[]),g.call(this,...N)}setConfig(e){return this}run(){this.config={...this.defaultConfig,...this.config},this.app.set(\"trust proxy\",1),l.a.each(this.inits,e=>{e.call(this)}),this.app.use(c()(\"dev\")),this.app.use(i.a.json()),this.use(i.a.urlencoded({extended:!1})),this.use(s()()),this.use(f()()),l.a.each(this.publicFolders,e=>{1===e.length?this.app.use(i.a.static(...e)):2===e.length&&this.app.use(e[0],i.a.static(e[1]))}),l.a.each(this.uses,e=>{this.app.use(...e)}),l.a.each(this.routers,e=>{let[t,r]=e;this.app[\"router\"===t?\"use\":t](...r)}),b.call(this)}},_=r(2),y=r.n(_);function U(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var D=class{constructor(){U(this,\"name\",void 0),U(this,\"fields\",{}),U(this,\"translatedFields\",[]),U(this,\"createForm\",null),U(this,\"editForm\",null),U(this,\"softDeletable\",!1),U(this,\"virtualFields\",{}),U(this,\"links\",{}),U(this,\"hooks\",{})}build(e){let t={};return l.a.each(Object.keys(this.fields),e=>{t[e]={type:this.fieldMapping(e),uniq:e.uniq}}),e.define(this.name,t,{tableName:this.name})}fieldMapping(e){switch(e.type){case\"text\":return y.a.STRING(void 0!==e.length?e.length:250);case\"boolean\":return y.a.BOOLEAN;default:return y.a.STRING(void 0!==e.length?e.length:250)}}};function x(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var M=class extends D{constructor(...e){super(...e),x(this,\"name\",\"user\"),x(this,\"fields\",{username:{type:\"text\",uniq:!0,length:250},password:{type:\"text\",length:500}})}};function C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var L=new class{constructor(){C(this,\"databases\",{main:{database:null,models:{}}}),C(this,\"models\",{user:M})}getModel(e,t=\"main\"){return this.databases[t].models[e]}init(e){this.databases.main.database=new y.a({...e.config.database,dialect:\"postgres\"}),this.processModels(\"main\"),this.databases.main.database.sync()}processModels(e){const t=this.databases[e].database;l.a.each(Object.keys(this.models),r=>{this.databases[e].models[r]=(new this.models[r]).build(t)})}};function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var S=new class{constructor(){P(this,\"pool\",{ROLE_SUPER_ADMIN:{ROLE_ADMIN:{ROLE_USER:{ROLE_ANONYMOUS:{}}}}}),P(this,\"flatPool\",{})}setHierarchy(e){this.pool=e}addRole(e=(e=>new Error(`Parameter '${e}' is required`))(\"roleName\"),t=null){if(null===t)this.pool[e.toUppercase()]={};else{if(void 0===this.pool[t.toUppercase()])throw new Error(`Role ${t} was not found in hierarchy`);this.pool[t.toUppercase()].roleName={}}}prepareHierarchy(){const e=(t,r)=>{const n=Object.keys(r);let i=[t];return l.a.each(n,t=>{const n=e(t,r[t]);this.flatPool[t]=n,i=[...i,...n]}),i};l.a.each(Object.keys(this.pool),t=>{this.flatPool[t]=e(t,this.pool[t])})}isGranted(e,t){return\"ROLE_ANONYMOUS\"===t||void 0!==e.session&&void 0!==e.session.user&&void 0!==this.flatPool[t]&&-1!==this.flatPool[t].indexOf(e.session.user.acl)}},k=r(7),F=r.n(k);const j=E,T=L,q=i.a,z=e=>(t,r,n)=>!0===S.isGranted(t,e)?n():n(F()(401,\"You are not allowed to access this area\"))}]));","extractedComments":[]}