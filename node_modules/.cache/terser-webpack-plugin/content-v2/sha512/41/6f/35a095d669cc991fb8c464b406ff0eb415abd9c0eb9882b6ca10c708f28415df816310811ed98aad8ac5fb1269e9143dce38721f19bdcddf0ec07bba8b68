{"code":"!function(e,t){for(var i in t)e[i]=t[i]}(exports,function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,\"a\",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p=\"\",i(i.s=12)}([function(e,t){e.exports=require(\"underscore\")},function(e,t){e.exports=require(\"express\")},function(e,t){e.exports=require(\"express-session\")},function(e,t){e.exports=require(\"sequelize\")},function(e,t){e.exports=require(\"cookie-parser\")},function(e,t){e.exports=require(\"morgan\")},function(e,t){e.exports=require(\"compression\")},function(e,t){e.exports=require(\"redis\")},function(e,t){e.exports=require(\"connect-redis\")},function(e,t){e.exports=require(\"http\")},function(e,t){e.exports=require(\"path\")},function(e,t){e.exports=require(\"socket.io\")},function(e,t,i){\"use strict\";i.r(t),i.d(t,\"App\",(function(){return D})),i.d(t,\"express\",(function(){return F}));var s=i(1),n=i.n(s),o=(i(10),i(4)),r=i.n(o),u=i(5),c=i.n(u),a=i(0),f=i.n(a),l=i(6),h=i.n(l),d={use:function(...e){return this.uses.push(e),this},get:function(...e){return this.routers.push([\"get\",e]),this},addRouter:function(...e){return this.routers.push([\"router\",e]),this},addPublic(...e){return this.publicFolders.push(e),this}},p=i(2),g=i.n(p),b=i(7),v=i.n(b),x=i(8),y=i.n(x),S={setSessionConfig:function(e,t,i){return void 0===t?this.config.session.config=e:this.config.session=void 0!==i?{type:e,config:t,redisConfig:i}:{type:e},this},init:function(){if(!0===this.config.useSession){let e=this.config.session.config;if(\"redis\"===this.config.session){e={store:new(y()(g.a))({client:v.a.createClient(this.config.session.redisConfig)}),...this.config.session.config}}this.app.use(g()(e))}}};i(3);var m=new class{constructor(){var e,t,i;i={},(t=\"models\")in(e=this)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}init(){console.log(\"init db\")}},k={setDatabaseConfig:function(e){return this.config.database=e,this},addModel:function(e){return this.models.push(e),this},addModels:function(...e){return this.models=[...this.models,...e],this},init:function(){\"object\"==typeof this.config.database&&m.init(this)}},j={setSocketConfig:function(e){return this.config.socket=void 0===e?{}:e,this},useSocket:function(e=!0,t=!1){return this.config.useSocket=e,this.config.useSessionSocket=t,this},addRooms:function(...e){return this.sockets=[...this.sockets,...e],this},initSocket:function(e){return this.io=e,console.log(\"Jinit le io\"),this}};var q=new class{constructor(){var e,t,i;i={},(t=\"modules\")in(e=this)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}addModule(e){}};var w=new class{constructor(){var e,t,i;i={},(t=\"website\")in(e=this)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}addWebsite(e){}},C={addWebsite:function(e){return w.addWebsite(e),this},addWebsites:function(...e){return f.a.each(e,e=>this.addWebsite(e)),this},addModule:function(e){return q.addModule(e),this},addModules:function(...e){return f.a.each(e,e=>this.addModule(e)),this},init:function(){}},O=i(9);let P;var M,_=function(){if(M=function(e){var t=parseInt(e,10);if(isNaN(t))return e;if(t>=0)return t;return!1}(process.env.PORT||\"3000\"),this.app.set(\"port\",M),P=O.createServer(this.app),!0===this.config.useSocket){const e=i(11)(P);this.initSocket(e)}P.listen(M),P.on(\"error\",E),P.on(\"listening\",W)};function W(){var e=P.address(),t=\"string\"==typeof e?\"pipe \"+e:\"port \"+e.port;console.log(\"Listening on \"+t)}function E(e){if(\"listen\"!==e.syscall)throw e;var t=\"string\"==typeof M?\"Pipe \"+M:\"Port \"+M;switch(e.code){case\"EACCES\":console.error(t+\" requires elevated privileges\"),process.exit(1);break;case\"EADDRINUSE\":console.error(t+\" is already in use\"),process.exit(1);break;default:throw e}}function R(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function A(...e){const t=[\"build\"];f.a.each(e,e=>{f.a.each(Object.keys(e),i=>{\"init\"===i?this.inits.push(e[i]):-1===t.indexOf(i)&&(this[i]=(...t)=>e[i].call(this,...t))})})}const D=new class{constructor(){R(this,\"app\",n()()),R(this,\"uses\",[]),R(this,\"routers\",[]),R(this,\"publicFolders\",[]),R(this,\"models\",[]),R(this,\"sockets\",[]),R(this,\"io\",null),R(this,\"config\",{session:{type:null,config:{},redisConfig:void 0},socket:{}}),R(this,\"defaultConfig\",{useCors:!1,statics:{},useSession:!0,useCompression:!0,useSocket:!1,useSessionSocket:!1}),R(this,\"inits\",[]),A.call(this,S,d,C,k,j)}setConfig(e){return this}run(){this.config={...this.defaultConfig,...this.config},this.app.set(\"trust proxy\",1),f.a.each(this.inits,e=>{e.call(this)}),this.app.use(c()(\"dev\")),this.app.use(n.a.json()),this.use(n.a.urlencoded({extended:!1})),this.use(r()()),this.use(h()()),f.a.each(this.publicFolders,e=>{1===e.length?this.app.use(n.a.static(...e)):2===e.length&&this.app.use(e[0],n.a.static(e[1]))}),f.a.each(this.uses,e=>{this.app.use(...e)}),f.a.each(this.routers,e=>{let[t,i]=e;this.app[\"router\"===t?\"use\":t](...i)}),_.call(this)}},F=n.a}]));","extractedComments":[]}